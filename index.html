<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abyssal Rhythm ∞ iNFiNiTY</title>
    <link href="index.css" rel="stylesheet" type="text/css"></link>

    <script src="./masonry.js"></script>
</head>

<body>
    <div class="home">
        <img class="bg" src="./image/bg.png">

        <div class="rhythm-wave-wrapper" id="rhythm-wave-wrapper">
            <canvas id="rhythm-wave"></canvas>
        </div>

        <div class="panel-all">
            <div class="illu"></div>

            <div class="info-panel">
                <div class="info-panel-all">
                    <div class="club-name">-溟律社-</div>
                    
                    <div class="song-name">
                        <span class="fade-effect" style="animation-delay: 0s;">Abyssal </span>
                        <span class="fade-effect" style="animation-delay: 0.3s;">Rhythm </span>
                        <span class="fade-effect" style="animation-delay: 0.6s;">∞ </span>
                        <span class="fade-effect" style="animation-delay: 0.9s;">iNFiNiTY</span>
                    </div>

                    <div class="artist-name">
                        <a class="fade-effect artist-name-link" 
                        style="animation-delay: 1.2s;" 
                        href="https://space.bilibili.com/2137653743?spm_id_from=333.337.search-card.all.click" 
                        target="_blank" 
                        rel="noopener noreferrer">——music by: ADHD_BC ——</a>
                    </div>
        
                    <div class="play-button-wrapper fade-effect" style="animation-delay: 1.6s;">
                        <button onclick="startMusic()" class="play-button" id="play-button">Play</button>
                        <audio id="bgm" src="./audio/bgm.mp3" loop></audio>
                    </div>

                    <div class="club-introduction-all">
                        <div class="club-introduction-part fade-effect" style="animation-delay: 2.4s;">
                            <div class="club-introduction">
                                <h3>社团简介</h3>
                                <p>音乐创作社团，注重音乐全周期制作。</p>
                            </div>
                        </div>
                        <div class="club-introduction-part fade-effect" style="animation-delay: 2.8s;">
                            <div class="club-introduction">
                                <h3>主要活动</h3>
                                <p>编曲作曲、填词作词、自主演奏。</p>
                            </div>
                        </div>
                        <div class="club-introduction-part fade-effect" style="animation-delay: 3.2s;">
                            <div class="club-introduction">
                                <h3>社团特色</h3>
                                <p>利用音乐软件，实现独特音效与质感。</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <script>
                //Homepage Background
                let music_playing = false;
                let triangles = [];
                let easing_value = 0;
                class Triangle {
                    constructor(pt1, pt2, pt3, motion, opacity) {
                        this.pt1 = pt1;
                        this.pt2 = pt2;
                        this.pt3 = pt3;
                        this.motion = motion;
                        this.opacity = opacity;
                    }

                    move() {
                        this.pt1.y -= this.motion;
                        this.pt2.y -= this.motion;
                        this.pt3.y -= this.motion;
                        this.motion++;
                        this.opacity -= 0.03;
                    }
                }
            </script>

            <script>
                function initCanvas_1(){
                    let canvas = document.getElementById("rhythm-wave");
                    const canvas_wrapper = document.getElementById("rhythm-wave-wrapper");
                    canvas.width  = canvas_wrapper.clientWidth;
                    canvas.height = canvas_wrapper.clientHeight;
                }
                initCanvas_1();

                function initCanvas_2(){
                    let canvas = document.getElementById("introduction-bg");
                    const canvas_wrapper = document.getElementById("introduction-bg-wrapper");
                    canvas.width  = canvas_wrapper.clientWidth;
                    canvas.height = canvas_wrapper.clientHeight;
                }
                initCanvas_2();
            </script>

            <script>
                function startMusic() {
                    music_playing = !music_playing;
                    if (music_playing) {
                        document.getElementById('bgm').play();
                        document.getElementById('play-button').innerText = 'Pause';
                    } else {
                        document.getElementById('bgm').pause();
                        document.getElementById('play-button').innerText = 'Play';
                    }
                }
                
                function triangleAnimationFrame() {
                    drawTriangles();
                    drawWaves();
                    requestAnimationFrame(triangleAnimationFrame);
                }
                requestAnimationFrame(triangleAnimationFrame);
            </script>

            <script>
                function drawTriangles() {
                    let canvas = document.getElementById("rhythm-wave");
                    let ctx = canvas.getContext("2d");
                    for (let i = triangles.length - 1; i >= 0; i--) {
                        let tri = triangles[i];
                        tri.move();
                        if (tri.opacity <= 0) {
                            triangles.splice(i, 1);
                        }
                    }
                    if (music_playing) triangles.push(createTriangle());
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    for (let tri of triangles) {
                        ctx.beginPath();
                        const hue = randInt(220, 280);          // 蓝-紫随机
                        ctx.strokeStyle = `hsla(${hue}, 100%, 60%, ${tri.opacity})`;
                        ctx.lineWidth = 4;
                        ctx.moveTo(tri.pt1.x, tri.pt1.y);
                        ctx.lineTo(tri.pt2.x, tri.pt2.y);
                        ctx.lineTo(tri.pt3.x, tri.pt3.y);
                        ctx.lineTo(tri.pt1.x, tri.pt1.y);
                        ctx.closePath();
                        ctx.stroke();
                    }
                }

                function drawWaves() {
                    let canvas = document.getElementById("rhythm-wave");
                    let ctx = canvas.getContext("2d");
                    if (music_playing) {
                        easing_value = Math.min(1, easing_value + 0.05);
                    } else {
                        easing_value = Math.max(0, easing_value - 0.02);
                    }
                    const divide_quantity = 100;
                    const column_width = canvas.width / divide_quantity * 0.75;
                    const time = performance.now();

                    for (let i = 0; i < divide_quantity; i++) {
                        const x = canvas.width / divide_quantity * i;
                        let curve_value = curve_formula((time/1000 + i)/3);
                        ctx.fillStyle = `hsla(${220 + 50 * i / divide_quantity}, 100%, 60%, 0.2)`;
                        let half_height = canvas.height / 4 * curve_value * Math.sin(easing_value / 2 * Math.PI);
                        ctx.fillRect(x, canvas.height / 2 - half_height, column_width, 2 * half_height);

                        ctx.fillStyle = `hsla(${235 + 50 * i / divide_quantity}, 100%, 60%, 0.4)`;
                        curve_value = curve_formula((time/800 + i)/3 + 1);
                        half_height = canvas.height / 4 * curve_value * Math.sin(easing_value / 2 * Math.PI) * 0.8;
                        ctx.fillRect(x, canvas.height / 2 - half_height, column_width, 2 * half_height);

                        ctx.fillStyle = `hsla(${250 + 50 * i / divide_quantity}, 100%, 60%, 0.6)`;
                        curve_value = curve_formula((time/600 + i)/3 + 2);
                        half_height = canvas.height / 4 * curve_value * Math.sin(easing_value / 2 * Math.PI) * 0.6;
                        ctx.fillRect(x, canvas.height / 2 - half_height, column_width, 2 * half_height);
                    }
                }
            </script>

            <script>
                const randInt = (min, max) =>
                    Math.floor(Math.random() * (max - min + 1)) + min;

                //Homepage Background
                function createTriangle() {
                    const canvas = document.getElementById("rhythm-wave");
                    const ptset = equilateralTriangleOnCircle(randInt(0, canvas.width), canvas.height+10, randInt(5, 15), randInt(0, 120) * Math.PI / 180);
                    return new Triangle(ptset[0], ptset[1], ptset[2], 0, 1);
                }

                function equilateralTriangleOnCircle(x0, y0, r, startAngle) {
                    const theta1 = startAngle;
                    const theta2 = startAngle + 2 * Math.PI / 3;
                    const theta3 = startAngle + 4 * Math.PI / 3;

                    return [
                        { x: x0 + r * Math.cos(theta1), y: y0 + r * Math.sin(theta1) },
                        { x: x0 + r * Math.cos(theta2), y: y0 + r * Math.sin(theta2) },
                        { x: x0 + r * Math.cos(theta3), y: y0 + r * Math.sin(theta3) }
                    ];
                }

                function curve_formula(x) {
                    return (0.2*Math.sin(x) + 0.5*(Math.sin(0.5*x)**2) + 0.3*Math.sin(2*x+1) + 0.4*Math.sin(3*x+1) + 1) / 2;
                }
            </script>
        </div>
    </div>
    
    <p class="introduction-title">-Members-</p>

    <div class="member-introduction">
        <div class="person-card">
            <img class="avatar" src="./image/shezhang_avatar.jpg">
            <div class="person-introduction-all">
                <div class="person-introduction">
                    <div class="avatar-name">
                        <h1>社长</h1>
                        <h2>Yimonekosfra</h2>
                    </div>
                    <h3>·自我介绍</h3>
                    <p>无名小卒，不知名文学家，音乐家，数理化爱好者（大雾），伪军事博主。爱好吹水，写文，emo，时不时犯唐。</p>
                    <h3>·人生格言</h3>
                    <p>“向死者生”</p>
                </div>
            </div>
        </div>
        <div class="person-card">
            <img class="avatar" src="./image/fushezhang_avatar.jpg">
            <div class="person-introduction-all">
                <div class="person-introduction">
                    <div class="avatar-name">
                        <h1>副社长</h1>
                        <h2>thousails</h2>
                    </div>
                    <h3>·人生格言</h3>
                    <p>“世界还未开始，你我皆是wonderhoy！”</p>
                </div>
            </div>
        </div>
        <div class="person-card">
            <img class="avatar" src="./image/guwen_avatar.jpg">
            <div class="person-introduction-all">
                <div class="person-introduction">
                    <div class="avatar-name">
                        <h1>顾问</h1>
                        <h2>ADHD_BC</h2>
                    </div>
                    <h3>·人生格言</h3>
                    <p>“想到什么就大胆去做，想到什么就立刻去做，不要给自己留下终生遗憾。”</p>
                </div>
            </div>
        </div>
        <div class="person-card">
            <img class="avatar" src="./image/zhanzhang_avatar.jpg">
            <div class="person-introduction-all">
                <div class="person-introduction">
                    <div class="avatar-name">
                        <h1>站长</h1>
                        <h2>Wenyan_Keith</h2>
                    </div>
                    <h3>·自我介绍</h3>
                    <p>撸代码撸到死；网络上的e人，现实里的i人；偶尔犯唐，有些神经质。</p>
                    <h3>·人生格言</h3>
                    <p>“选择形成责任，规则造就品德”，一切都是最好的安排。</p>
                </div>
            </div>
        </div>
    </div>
    <script>
        var elem = document.querySelector('.member-introduction');
        var msnry = new Masonry( elem, {
        // options
        itemSelector: '.person-card',
        columnWidth: 'person-card'
        });
        // element argument can be a selector string
        //   for an individual element
        var msnry = new Masonry( '.member-introduction', {
        // options
        });
    </script>

    <p class="introduction-title">-ABOUT US-</p>
    
</body>
</html>